<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracking Invitați Nuntă</title>
    <style>
        :root {
            --primary: #d4a373;
            --secondary: #faedcd;
            --text: #4a4a4a;
            --light: #fefae0;
            --accent: #ccd5ae;
            --danger: #e76f51;
            --success: #588157;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light);
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--primary);
            border-radius: 10px;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        h1 {
            margin: 0;
            font-size: 2.2rem;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 15px;
            background-color: var(--secondary);
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-box {
            text-align: center;
            padding: 10px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text);
        }

        .categories {
            display: grid;
            grid-template-columns: 1fr; /* Single column layout */
            gap: 20px;
        }

        .category {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .category-title {
            color: var(--primary);
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .guest-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .guest-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 6px;
            transition: background-color 0.2s;
            position: relative;
        }

        .guest-item:hover {
            background-color: var(--secondary);
        }

        .guest-name {
            flex-grow: 1;
            margin-left: 10px;
            font-weight: 500;
            overflow: hidden;
            word-break: break-word;
        }

        .guest-actions {
            display: flex;
            gap: 5px;
        }

        .icon-button {
            width: 24px;
            height: 24px;
            cursor: pointer;
            color: #888;
            transition: color 0.2s;
            background: none;
            border: none;
            padding: 0;
        }

        .icon-button:hover {
            color: var(--primary);
        }

        .icon-button.delete:hover {
            color: var(--danger);
        }

        .icon-button.edit:hover {
            color: var(--success);
        }

        .gift-popup {
            position: absolute;
            right: 85px;
            top: 0;
            background-color: var(--primary);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 10;
        }

        .gift-popup::after {
            content: '';
            position: absolute;
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
            border-width: 6px 0 6px 6px;
            border-style: solid;
            border-color: transparent transparent transparent var(--primary);
        }

        .search-bar {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border: 2px solid var(--secondary);
            border-radius: 6px;
            margin-bottom: 20px;
            box-sizing: border-box;
        }

        /* Checkbox styling */
        .custom-checkbox {
            position: relative;
            display: inline-block;
            width: 24px;
            height: 24px;
            background-color: #fff;
            border: 2px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .status-0 {
            background-color: #fff;
        }

        .status-1 {
            background-color: var(--accent);
        }

        .status-1::after {
            content: "✉";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #4a4a4a;
            font-size: 14px;
        }

        .status-2 {
            background-color: var(--primary);
        }

        .status-2::after {
            content: "✓";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 16px;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            color: var(--primary);
            font-size: 1.5rem;
            margin: 0;
        }

        .close-btn {
            font-size: 1.5rem;
            cursor: pointer;
            color: #888;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .button-group {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-secondary {
            background-color: #ccc;
            color: #333;
        }

        .add-guest-btn {
            background-color: var(--success);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-left: 10px;
            transition: background-color 0.2s;
        }

        .add-guest-btn:hover {
            background-color: #3a5a40;
        }

        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .action-button {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .action-button:hover {
            background-color: #bc8a5f;
        }

        .action-button.green {
            background-color: var(--success);
        }

        .action-button.green:hover {
            background-color: #3a5a40;
        }

        /* Reorder Categories Modal */
        .category-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 8px;
            background-color: white;
            cursor: grab;
        }

        .category-item:active {
            cursor: grabbing;
        }

        .category-item-name {
            flex-grow: 1;
        }

        .drag-handle {
            color: #888;
            margin-right: 10px;
            cursor: grab;
        }

        .delete-category-btn {
            color: var(--danger);
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-category-btn:hover {
            color: #c05046;
        }

        @media (max-width: 768px) {
            .stats {
                flex-wrap: wrap;
            }
            
            .stat-box {
                width: 45%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Tracking Invitați Nuntă</h1>
        </header>

        <div class="action-buttons">
            <button id="addCategoryBtn" class="action-button green">Adaugă Categorie Nouă</button>
            <button id="reorderCategoriesBtn" class="action-button">Reordonează Categorii</button>
            <button id="exportDataBtn" class="action-button">Exportă Date</button>
        </div>

        <input type="text" id="searchGuests" class="search-bar" placeholder="Caută invitați...">

        <div class="stats">
            <div class="stat-box">
                <div class="stat-value" id="totalGuests">0</div>
                <div class="stat-label">Total Invitați</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="invitationSent">0</div>
                <div class="stat-label">Invitații Trimise</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="confirmed">0</div>
                <div class="stat-label">Confirmați</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="totalGift">0</div>
                <div class="stat-label">Total Cadouri</div>
            </div>
        </div>

        <div class="categories" id="categories">
            <!-- Categories will be populated here -->
        </div>
    </div>

    <!-- Add Guest Modal -->
    <div id="addGuestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Adaugă Invitat Nou</h3>
                <span class="close-btn" id="closeAddGuestModal">&times;</span>
            </div>
            <div class="form-group">
                <label for="guestName">Nume Invitat:</label>
                <input type="text" id="guestName" placeholder="Ex: Ion + Maria">
            </div>
            <div class="form-group">
                <label for="guestCategory">Categorie:</label>
                <select id="guestCategory">
                    <!-- Categories will be populated here -->
                </select>
            </div>
            <div class="form-group">
                <label for="guestGift">Cadou (opțional):</label>
                <input type="text" id="guestGift" placeholder="Ex: 500 lei sau 100 €">
            </div>
            <div class="button-group">
                <button id="cancelAddGuest" class="btn btn-secondary">Anulează</button>
                <button id="saveNewGuest" class="btn btn-primary">Salvează</button>
            </div>
        </div>
    </div>

    <!-- Edit Guest Modal -->
    <div id="editGuestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editează Invitat</h3>
                <span class="close-btn" id="closeEditGuestModal">&times;</span>
            </div>
            <div class="form-group">
                <label for="editGuestName">Nume Invitat:</label>
                <input type="text" id="editGuestName">
            </div>
            <div class="form-group">
                <label for="editGuestCategory">Categorie:</label>
                <select id="editGuestCategory">
                    <!-- Categories will be populated here -->
                </select>
            </div>
            <div class="form-group">
                <label for="editGuestGift">Cadou:</label>
                <input type="text" id="editGuestGift">
            </div>
            <input type="hidden" id="editGuestIndex">
            <div class="button-group">
                <button id="cancelEditGuest" class="btn btn-secondary">Anulează</button>
                <button id="updateGuest" class="btn btn-primary">Actualizează</button>
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="addCategoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Adaugă Categorie Nouă</h3>
                <span class="close-btn" id="closeAddCategoryModal">&times;</span>
            </div>
            <div class="form-group">
                <label for="categoryName">Nume Categorie:</label>
                <input type="text" id="categoryName" placeholder="Ex: Prieteni din liceu">
            </div>
            <div class="button-group">
                <button id="cancelAddCategory" class="btn btn-secondary">Anulează</button>
                <button id="saveNewCategory" class="btn btn-primary">Salvează</button>
            </div>
        </div>
    </div>

    <!-- Reorder Categories Modal -->
    <div id="reorderCategoriesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Reordonează Categorii</h3>
                <span class="close-btn" id="closeReorderModal">&times;</span>
            </div>
            <p>Trage și plasează categoriile pentru a le reordona. Categoria "Echipa nunta" va fi întotdeauna ultima.</p>
            <div id="categoryOrderList">
                <!-- Categories will be populated here -->
            </div>
            <div class="button-group">
                <button id="cancelReorder" class="btn btn-secondary">Anulează</button>
                <button id="saveNewOrder" class="btn btn-primary">Salvează</button>
            </div>
        </div>
    </div>

    <script>
        // Guest data with status already set to 0
        let guestData = [
            // Rude Iulia
            { name: "Vera + Adi Cojocaru", category: "Rude Iulia", gift: "850 lei", status: 0 },
            { name: "Violeta + Mihai", category: "Rude Iulia", gift: "1000 lei", status: 0 },
            { name: "Alex + Anca Rada", category: "Rude Iulia", gift: "800 lei", status: 0 },
            { name: "Alex + 1", category: "Rude Iulia", gift: "", status: 0 },
            { name: "Nasu + Nasa Mariana", category: "Rude Iulia", gift: "", status: 0 },
            { name: "Bogdan + Anca", category: "Rude Iulia", gift: "", status: 0 },
            { name: "Victor + Claudia", category: "Rude Iulia", gift: "", status: 0 },
            { name: "Nasa Lenuta + Aurora", category: "Rude Iulia", gift: "", status: 0 },
            { name: "Lenuta + Cristi", category: "Rude Iulia", gift: "", status: 0 },
            { name: "Iuli +1", category: "Rude Iulia", gift: "1500 lei", status: 0 },
            { name: "Adriana + Catalin", category: "Rude Iulia", gift: "", status: 0 },
            { name: "Mosica + Fane + Edi", category: "Rude Iulia", gift: "", status: 0 },
            { name: "Jeni + Radu", category: "Rude Iulia", gift: "", status: 0 },

            // Serviciu Mami
            { name: "Geogiana +1 Popescu", category: "Serviciu Mami", gift: "900 lei", status: 0 },
            { name: "Anca + Cosmin Bestea", category: "Serviciu Mami", gift: "200€", status: 0 },
            { name: "Mari + 1 Bucuresti", category: "Serviciu Mami", gift: "800 lei", status: 0 },
            { name: "Nicoleta + 1 SuperBet", category: "Serviciu Mami", gift: "1000 lei", status: 0 },
            { name: "Mihaela +1 Bojan", category: "Serviciu Mami", gift: "1000 lei", status: 0 },
            { name: "Amelia + Cosmin SuperBet", category: "Serviciu Mami", gift: "1000 lei", status: 0 },
            { name: "Oana + 1 SuperBet", category: "Serviciu Mami", gift: "300€", status: 0 },
            { name: "Dna Stefana + 1 Filiasi", category: "Serviciu Mami", gift: "300€", status: 0 },
            { name: "Gabi Succes + 1", category: "Serviciu Mami", gift: "", status: 0 },
            { name: "Carmen + Liviu", category: "Serviciu Mami", gift: "", status: 0 },

            // Serviciu Tati
            { name: "Alex + 1 Broncea", category: "Serviciu Tati", gift: "800 lei", status: 0 },
            { name: "Grati + 1 TDG", category: "Serviciu Tati", gift: "300 €", status: 0 },
            { name: "Alina Matei + Bebe", category: "Serviciu Tati", gift: "", status: 0 },

            // Vecini Iulia
            { name: "Mirela + 1 Zanoaga", category: "Vecini Iulia", gift: "1000 lei", status: 0 },
            { name: "Lili + 1 Olteanu", category: "Vecini Iulia", gift: "1000 lei", status: 0 },
            { name: "Miti + 1 Motoci", category: "Vecini Iulia", gift: "1000 lei", status: 0 },
            { name: "Cosmin + Alexandra Barbulescu", category: "Vecini Iulia", gift: "300€", status: 0 },
            { name: "Monica + 1 Munteanu", category: "Vecini Iulia", gift: "300 €", status: 0 },
            { name: "Costela + Aurel", category: "Vecini Iulia", gift: "", status: 0 },
            { name: "Irina + Irinel", category: "Vecini Iulia", gift: "", status: 0 },
            { name: "Costel Enasoiu +1", category: "Vecini Iulia", gift: "", status: 0 },
            { name: "Florin + Angie", category: "Vecini Iulia", gift: "", status: 0 },
            { name: "Gabi Mariuta +1", category: "Vecini Iulia", gift: "", status: 0 },
            { name: "Dan + Mihaela", category: "Vecini Iulia", gift: "", status: 0 },
            { name: "Adrian Pompieru + 1", category: "Vecini Iulia", gift: "", status: 0 },
            { name: "Marius + Tania", category: "Vecini Iulia", gift: "", status: 0 },
            { name: "Paul(Ionut) + Alina", category: "Vecini Iulia", gift: "", status: 0 },
            { name: "Ingineru + Viorica", category: "Vecini Iulia", gift: "", status: 0 },

            // Vecini Adi
            { name: "Elena + 1 Popescu", category: "Vecini Adi", gift: "300 €", status: 0 },
            { name: "Nea Cristi + 1", category: "Vecini Adi", gift: "", status: 0 },
            { name: "Catalin + Madalina", category: "Vecini Adi", gift: "300 €", status: 0 },
            { name: "Petre Ungureanu+1", category: "Vecini Adi", gift: "", status: 0 },
            { name: "Patroi +1", category: "Vecini Adi", gift: "", status: 0 },
            { name: "Goguta + Luminita", category: "Vecini Adi", gift: "500 €", status: 0 },
            { name: "Alexut +1", category: "Vecini Adi", gift: "", status: 0 },
            { name: "Adriana Popescu +1", category: "Vecini Adi", gift: "500 €", status: 0 },

            // Facultate Iulia
            { name: "Flavia + Doru", category: "Facultate Iulia", gift: "200 €", status: 0 },
            { name: "Lavinia + Nadia", category: "Facultate Iulia", gift: "", status: 0 },
            { name: "Ispas + Luminita", category: "Facultate Iulia", gift: "300 €", status: 0 },
            { name: "Rosu Razvan +1", category: "Facultate Iulia", gift: "", status: 0 },
            { name: "Denisa +1", category: "Facultate Iulia", gift: "", status: 0 },
            { name: "Jianu +1", category: "Facultate Iulia", gift: "", status: 0 },
            { name: "Vinatoru +1", category: "Facultate Iulia", gift: "", status: 0 },
            { name: "Alexandra + Bogdan", category: "Facultate Iulia", gift: "", status: 0 },
            { name: "Lion +1", category: "Facultate Iulia", gift: "", status: 0 },

            // Facultate Adi
            { name: "Claudiu + Roxana Barascu", category: "Facultate Adi", gift: "200 €", status: 0 },
            { name: "Alex Gentoiu + 1", category: "Facultate Adi", gift: "", status: 0 },
            { name: "Bobo + Anca", category: "Facultate Adi", gift: "200€", status: 0 },
            { name: "Victor +1", category: "Facultate Adi", gift: "", status: 0 },
            { name: "Andy + 1", category: "Facultate Adi", gift: "", status: 0 },

            // Serviciu Iulia
            { name: "Poe + 1", category: "Serviciu Iulia", gift: "200€", status: 0 },
            { name: "Claudia + Cosmin", category: "Serviciu Iulia", gift: "800 lei", status: 0 },
            { name: "Irina + Dan", category: "Serviciu Iulia", gift: "", status: 0 },
            { name: "Claudiu + Adina", category: "Serviciu Iulia", gift: "500 lei", status: 0 },
            { name: "Bogdan + Ioana", category: "Serviciu Iulia", gift: "", status: 0 },
            { name: "Andrei +1", category: "Serviciu Iulia", gift: "", status: 0 },
            { name: "Mihnea + Elena", category: "Serviciu Iulia", gift: "", status: 0 },
            { name: "Ciprian +1", category: "Serviciu Iulia", gift: "", status: 0 },
            { name: "Cristi +1", category: "Serviciu Iulia", gift: "", status: 0 },
            { name: "Razvan + 1", category: "Serviciu Iulia", gift: "", status: 0 },
            { name: "Mihai + Laura", category: "Serviciu Iulia", gift: "", status: 0 },
            { name: "Maria Majon + Cosmin Balutoiu", category: "Serviciu Iulia", gift: "", status: 0 },
            { name: "Ovi + 1", category: "Serviciu Iulia", gift: "", status: 0 },
            { name: "Adi Furniga + 1", category: "Serviciu Iulia", gift: "", status: 0 },
            { name: "Gabi Smarandache+1", category: "Serviciu Iulia", gift: "", status: 0 },
            { name: "Vasi", category: "Serviciu Iulia", gift: "", status: 0 },
            { name: "Micu + Alexandra", category: "Serviciu Iulia", gift: "", status: 0 },

            // Serviciu Adi
            { name: "Mihaela +1 Popa", category: "Serviciu Adi", gift: "200€", status: 0 },
            { name: "Teo + Cristina Alexiu", category: "Serviciu Adi", gift: "200€", status: 0 },
            { name: "Lion + Lili", category: "Serviciu Adi", gift: "300€", status: 0 },
            { name: "Johny+1", category: "Serviciu Adi", gift: "", status: 0 },
            { name: "Andrei +1", category: "Serviciu Adi", gift: "", status: 0 },
            { name: "Stefan + 1", category: "Serviciu Adi", gift: "", status: 0 },
            { name: "Catalin +1", category: "Serviciu Adi", gift: "", status: 0 },
            { name: "Tudor+ 1", category: "Serviciu Adi", gift: "", status: 0 },

            // Prieteni
            { name: "Cosmin+ 1", category: "Prieteni", gift: "", status: 0 },
            { name: "Nicu + Bianca", category: "Prieteni", gift: "", status: 0 },
            { name: "Daniel Frizeru +1", category: "Prieteni", gift: "", status: 0 },
            { name: "Gavrila + 1", category: "Prieteni", gift: "", status: 0 },
            { name: "Cosmin CMT +1", category: "Prieteni", gift: "", status: 0 },
            { name: "Arabela +1", category: "Prieteni", gift: "", status: 0 },
            { name: "Andrei Bardi +1", category: "Prieteni", gift: "", status: 0 },

            // Rude Adi
            { name: "Ionel + Cristina", category: "Rude Adi", gift: "", status: 0 },
            { name: "Sorin(Cioara)+1", category: "Rude Adi", gift: "", status: 0 },
            { name: "Bunica + Victor", category: "Rude Adi", gift: "", status: 0 },
            { name: "Ema + 1", category: "Rude Adi", gift: "", status: 0 },
            { name: "Vilceanu +1", category: "Rude Adi", gift: "", status: 0 },
            { name: "Mironel +1", category: "Rude Adi", gift: "", status: 0 },
            { name: "Tania +1", category: "Rude Adi", gift: "", status: 0 },
            { name: "Felicia+1", category: "Rude Adi", gift: "", status: 0 },
            { name: "Gabi + Flori", category: "Rude Adi", gift: "", status: 0 },
            { name: "Gicoiu + Gabi", category: "Rude Adi", gift: "", status: 0 },
            { name: "Buburuza + Razvan", category: "Rude Adi", gift: "", status: 0 },
            { name: "Andrei + Raluca", category: "Rude Adi", gift: "", status: 0 },

            // Echipa nunta
            { name: "Echipa nunta 1", category: "Echipa nunta", gift: "", status: 0 },
            { name: "Echipa nunta 2", category: "Echipa nunta", gift: "", status: 0 },
            { name: "Echipa nunta 3", category: "Echipa nunta", gift: "", status: 0 },
            { name: "Echipa nunta 4", category: "Echipa nunta", gift: "", status: 0 },
            { name: "Echipa nunta 5", category: "Echipa nunta", gift: "", status: 0 },
        ];

        // Category order (initialize with default order)
        let categoryOrder = [
            "Rude Iulia",
            "Rude Adi",
            "Serviciu Mami",
            "Serviciu Tati", 
            "Serviciu Iulia",
            "Serviciu Adi",
            "Vecini Iulia",
            "Vecini Adi",
            "Facultate Iulia", 
            "Facultate Adi",
            "Prieteni",
            "Echipa nunta" // Keep this last
        ];

        // Function to get unique categories
        function getUniqueCategories() {
            // Get all categories from guest data
            const allCategories = [...new Set(guestData.map(guest => guest.category))];
            
            // Filter out categories that are already in categoryOrder
            const newCategories = allCategories.filter(cat => !categoryOrder.includes(cat));
            
            // Add new categories to the order (before "Echipa nunta" if it exists)
            if (newCategories.length > 0) {
                if (categoryOrder.includes("Echipa nunta")) {
                    // Find index of "Echipa nunta"
                    const echipaIndex = categoryOrder.indexOf("Echipa nunta");
                    // Insert new categories before "Echipa nunta"
                    categoryOrder.splice(echipaIndex, 0, ...newCategories);
                } else {
                    // Just add to the end
                    categoryOrder.push(...newCategories);
                }
            }
            
            return categoryOrder;
        }

        // Function to render all guests
        function renderGuests() {
            // Group guests by category
            const groupedGuests = guestData.reduce((acc, guest) => {
                if (!acc[guest.category]) {
                    acc[guest.category] = [];
                }
                acc[guest.category].push(guest);
                return acc;
            }, {});

            // Get ordered categories
            const orderedCategories = getUniqueCategories();
            
            // Clear existing categories
            const categoriesContainer = document.getElementById('categories');
            categoriesContainer.innerHTML = '';
            
            // Generate HTML for categories and guests in the specified order
            orderedCategories.forEach(category => {
                // Skip categories that have no guests
                if (!groupedGuests[category] || groupedGuests[category].length === 0) {
                    return;
                }
                
                const categoryElement = document.createElement('div');
                categoryElement.className = 'category';
                categoryElement.dataset.category = category;
                
                categoryElement.innerHTML = `
                    <h2 class="category-title">
                        ${category} (${groupedGuests[category].length})
                        <button class="add-guest-btn" data-category="${category}">+ Adaugă Invitat</button>
                    </h2>
                    <div class="guest-list" id="category-${category.replace(/\s+/g, '-').toLowerCase()}">
                    </div>
                `;
                
                categoriesContainer.appendChild(categoryElement);
                
                const guestListElement = document.getElementById(`category-${category.replace(/\s+/g, '-').toLowerCase()}`);
                
                groupedGuests[category].forEach((guest) => {
                    const guestElement = document.createElement('div');
                    guestElement.className = 'guest-item';
                    guestElement.dataset.guestIndex = guestData.indexOf(guest);
                    
                    guestElement.innerHTML = `
                        <div class="custom-checkbox status-${guest.status}" onclick="toggleStatus(${guestData.indexOf(guest)})"></div>
                        <div class="guest-name">${guest.name}</div>
                        <div class="guest-actions">
                            ${guest.gift ? `
                                <button class="icon-button" onclick="toggleGiftPopup(${guestData.indexOf(guest)})">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="20 12 20 22 4 22 4 12"></polyline>
                                        <rect x="2" y="7" width="20" height="5"></rect>
                                        <line x1="12" y1="22" x2="12" y2="7"></line>
                                        <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path>
                                        <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path>
                                    </svg>
                                </button>
                                <div class="gift-popup" id="gift-popup-${guestData.indexOf(guest)}">${guest.gift}</div>
                            ` : ''}
                            <button class="icon-button edit" onclick="openEditGuestModal(${guestData.indexOf(guest)})">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                            </button>
                            <button class="icon-button delete" onclick="deleteGuest(${guestData.indexOf(guest)})">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                </svg>
                            </button>
                        </div>
                    `;
                    
                    guestListElement.appendChild(guestElement);
                });
            });

            // Add event listeners to "Add Guest" buttons
            document.querySelectorAll('.add-guest-btn').forEach(button => {
                button.addEventListener('click', function() {
                    openAddGuestModal(this.dataset.category);
                });
            });

            updateStats();
        }

        // Function to toggle guest status
        function toggleStatus(guestIndex) {
            const guest = guestData[guestIndex];
            guest.status = (guest.status + 1) % 3;
            
            const checkbox = document.querySelector(`[data-guest-index="${guestIndex}"] .custom-checkbox`);
            checkbox.className = `custom-checkbox status-${guest.status}`;
            
            updateStats();
        }

        // Function to toggle gift popup visibility
        function toggleGiftPopup(guestIndex) {
            const popup = document.getElementById(`gift-popup-${guestIndex}`);
            
            // Close all other popups
            document.querySelectorAll('.gift-popup').forEach(p => {
                if (p.id !== `gift-popup-${guestIndex}`) {
                    p.style.display = 'none';
                }
            });
            
            // Toggle this popup
            popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
        }

        // Function to update statistics
        function updateStats() {
            const totalGuests = guestData.length;
            const invitationSent = guestData.filter(guest => guest.status === 1).length;
            const confirmed = guestData.filter(guest => guest.status === 2).length;
            
            document.getElementById('totalGuests').textContent = totalGuests;
            document.getElementById('invitationSent').textContent = invitationSent;
            document.getElementById('confirmed').textContent = confirmed;
            
            // Calculate total gifts
            let totalLei = 0;
            let totalEuro = 0;
            
            guestData.forEach(guest => {
                if (guest.gift) {
                    if (guest.gift.includes('lei')) {
                        const amount = parseInt(guest.gift.replace(/[^\d]/g, ''));
                        if (!isNaN(amount)) {
                            totalLei += amount;
                        }
                    } else if (guest.gift.includes('€')) {
                        const amount = parseInt(guest.gift.replace(/[^\d]/g, ''));
                        if (!isNaN(amount)) {
                            totalEuro += amount;
                        }
                    }
                }
            });
            
            document.getElementById('totalGift').textContent = `${totalLei} lei / ${totalEuro} €`;
        }

        // Open Add Guest Modal
        function openAddGuestModal(category) {
            const modal = document.getElementById('addGuestModal');
            const categorySelect = document.getElementById('guestCategory');
            
            // Populate category dropdown
            populateCategoryDropdown(categorySelect, category);
            
            modal.style.display = 'block';
        }

        // Open Edit Guest Modal
        function openEditGuestModal(guestIndex) {
            const guest = guestData[guestIndex];
            const modal = document.getElementById('editGuestModal');
            
            document.getElementById('editGuestName').value = guest.name;
            document.getElementById('editGuestGift').value = guest.gift;
            document.getElementById('editGuestIndex').value = guestIndex;
            
            const categorySelect = document.getElementById('editGuestCategory');
            populateCategoryDropdown(categorySelect, guest.category);
            
            modal.style.display = 'block';
        }

        // Populate category dropdown
        function populateCategoryDropdown(selectElement, selectedCategory) {
            // Get ordered categories
            const categories = getUniqueCategories();
            
            // Clear existing options
            selectElement.innerHTML = '';
            
            // Add options for each category
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                
                if (category === selectedCategory) {
                    option.selected = true;
                }
                
                selectElement.appendChild(option);
            });
        }

        // Save a new guest
        function saveNewGuest() {
            const name = document.getElementById('guestName').value.trim();
            const category = document.getElementById('guestCategory').value;
            const gift = document.getElementById('guestGift').value.trim();
            
            if (name === '') {
                alert('Introduceți numele invitatului!');
                return;
            }
            
            // Add new guest to the data
            guestData.push({
                name,
                category,
                gift,
                status: 0
            });
            
            // Close modal and rerender
            document.getElementById('addGuestModal').style.display = 'none';
            document.getElementById('guestName').value = '';
            document.getElementById('guestGift').value = '';
            
            renderGuests();
        }

        // Update an existing guest
        function updateGuest() {
            const guestIndex = parseInt(document.getElementById('editGuestIndex').value);
            const name = document.getElementById('editGuestName').value.trim();
            const category = document.getElementById('editGuestCategory').value;
            const gift = document.getElementById('editGuestGift').value.trim();
            
            if (name === '') {
                alert('Introduceți numele invitatului!');
                return;
            }
            
            // Update guest data
            guestData[guestIndex].name = name;
            guestData[guestIndex].category = category;
            guestData[guestIndex].gift = gift;
            
            // Close modal and rerender
            document.getElementById('editGuestModal').style.display = 'none';
            
            renderGuests();
        }

        // Delete a guest
        function deleteGuest(guestIndex) {
            if (confirm('Sigur doriți să ștergeți acest invitat?')) {
                guestData.splice(guestIndex, 1);
                renderGuests();
            }
        }

        // Open Add Category Modal
        function openAddCategoryModal() {
            document.getElementById('addCategoryModal').style.display = 'block';
        }

        // Save a new category
        function saveNewCategory() {
            const categoryName = document.getElementById('categoryName').value.trim();
            
            if (categoryName === '') {
                alert('Introduceți numele categoriei!');
                return;
            }
            
            // Check if category already exists
            const existingCategories = [...new Set(guestData.map(guest => guest.category))];
            if (existingCategories.includes(categoryName)) {
                alert('Această categorie deja există!');
                return;
            }
            
            // Add to category order (before "Echipa nunta" if it exists)
            if (categoryOrder.includes("Echipa nunta")) {
                // Insert before "Echipa nunta"
                categoryOrder.splice(categoryOrder.length - 1, 0, categoryName);
            } else {
                // Just add to the end
                categoryOrder.push(categoryName);
            }
            
            // Create a dummy guest to ensure the category appears
            guestData.push({
                name: 'Primul invitat',
                category: categoryName,
                gift: '',
                status: 0
            });
            
            // Close modal and rerender
            document.getElementById('addCategoryModal').style.display = 'none';
            document.getElementById('categoryName').value = '';
            
            renderGuests();
        }

        // Open Reorder Categories Modal
        function openReorderCategoriesModal() {
            const modal = document.getElementById('reorderCategoriesModal');
            const categoryList = document.getElementById('categoryOrderList');
            
            // Clear existing items
            categoryList.innerHTML = '';
            
            // Get categories
            const categories = getUniqueCategories();
            
            // Create items for each category (except "Echipa nunta" if it's the last one)
            categories.forEach((category, index) => {
                if (category === "Echipa nunta" && index === categories.length - 1) {
                    // Skip "Echipa nunta" if it's the last one
                    return;
                }
                
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-item';
                categoryItem.draggable = true;
                categoryItem.dataset.category = category;
                
                categoryItem.innerHTML = `
                    <span class="drag-handle">≡</span>
                    <span class="category-item-name">${category}</span>
                    <button class="delete-category-btn" data-category="${category}" title="Șterge categorie">×</button>
                `;
                
                categoryList.appendChild(categoryItem);
            });
            
            // Add "Echipa nunta" as the last one (if it exists)
            if (categories.includes("Echipa nunta")) {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-item';
                categoryItem.style.backgroundColor = '#faedcd';
                categoryItem.dataset.category = "Echipa nunta";
                
                categoryItem.innerHTML = `
                    <span class="category-item-name">Echipa nunta (întotdeauna ultima)</span>
                `;
                
                categoryList.appendChild(categoryItem);
            }
            
            // Setup drag and drop
            setupDragAndDrop();
            
            // Setup delete category buttons
            setupDeleteCategoryButtons();
            
            modal.style.display = 'block';
        }

        // Setup drag and drop for category reordering
        function setupDragAndDrop() {
            const items = document.querySelectorAll('.category-item');
            let draggedItem = null;
            
            items.forEach(item => {
                if (item.dataset.category === "Echipa nunta") {
                    // Skip "Echipa nunta"
                    return;
                }
                
                item.addEventListener('dragstart', function() {
                    draggedItem = this;
                    setTimeout(() => this.style.opacity = '0.5', 0);
                });
                
                item.addEventListener('dragend', function() {
                    setTimeout(() => this.style.opacity = '1', 0);
                    draggedItem = null;
                });
                
                item.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    if (this.dataset.category === "Echipa nunta") {
                        // Cannot drop on "Echipa nunta"
                        return;
                    }
                });
                
                item.addEventListener('dragenter', function(e) {
                    e.preventDefault();
                    if (this !== draggedItem && this.dataset.category !== "Echipa nunta") {
                        this.style.backgroundColor = '#faedcd';
                    }
                });
                
                item.addEventListener('dragleave', function() {
                    if (this !== draggedItem && this.dataset.category !== "Echipa nunta") {
                        this.style.backgroundColor = '';
                    }
                });
                
                item.addEventListener('drop', function(e) {
                    e.preventDefault();
                    if (this !== draggedItem && this.dataset.category !== "Echipa nunta") {
                        const container = document.getElementById('categoryOrderList');
                        const items = Array.from(container.querySelectorAll('.category-item'));
                        const draggedIndex = items.indexOf(draggedItem);
                        const targetIndex = items.indexOf(this);
                        
                        if (draggedIndex < targetIndex) {
                            container.insertBefore(draggedItem, this.nextSibling);
                        } else {
                            container.insertBefore(draggedItem, this);
                        }
                        
                        this.style.backgroundColor = '';
                    }
                });
            });
        }

        // Setup delete category buttons
        function setupDeleteCategoryButtons() {
            document.querySelectorAll('.delete-category-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const category = this.dataset.category;
                    
                    if (confirm(`Sigur doriți să ștergeți categoria "${category}" și toți invitații din ea?`)) {
                        // Remove the category from order
                        const index = categoryOrder.indexOf(category);
                        if (index !== -1) {
                            categoryOrder.splice(index, 1);
                        }
                        
                        // Remove all guests from this category
                        guestData = guestData.filter(guest => guest.category !== category);
                        
                        // Remove this category item from the modal
                        const categoryItem = this.closest('.category-item');
                        categoryItem.remove();
                    }
                });
            });
        }

        // Save the new category order
        function saveNewCategoryOrder() {
            // Get the new order from the modal
            const items = document.querySelectorAll('.category-item');
            const newOrder = [];
            
            items.forEach(item => {
                newOrder.push(item.dataset.category);
            });
            
            // Save the new order
            categoryOrder = newOrder;
            
            // Close modal and rerender
            document.getElementById('reorderCategoriesModal').style.display = 'none';
            
            renderGuests();
        }

        // Export data to CSV
        function exportData() {
            // Create CSV content
            let csvContent = 'Nume,Categorie,Cadou,Status\n';
            
            guestData.forEach(guest => {
                let status = '';
                switch(guest.status) {
                    case 0: status = 'Neinvitat'; break;
                    case 1: status = 'Invitație trimisă'; break;
                    case 2: status = 'Confirmat'; break;
                }
                
                csvContent += `"${guest.name}","${guest.category}","${guest.gift}","${status}"\n`;
            });
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'invitati_nunta.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Search functionality
        document.getElementById('searchGuests').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            document.querySelectorAll('.guest-item').forEach(item => {
                const guestIndex = parseInt(item.dataset.guestIndex);
                const guest = guestData[guestIndex];
                
                if (guest.name.toLowerCase().includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Show/hide empty categories
            document.querySelectorAll('.category').forEach(categoryElement => {
                const visibleGuests = categoryElement.querySelectorAll('.guest-item[style="display: flex;"], .guest-item:not([style])').length;
                
                if (visibleGuests === 0 && searchTerm !== '') {
                    categoryElement.style.display = 'none';
                } else {
                    categoryElement.style.display = 'block';
                }
            });
        });

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Add Category Button
            document.getElementById('addCategoryBtn').addEventListener('click', openAddCategoryModal);
            
            // Reorder Categories Button
            document.getElementById('reorderCategoriesBtn').addEventListener('click', openReorderCategoriesModal);
            
            // Export Data Button
            document.getElementById('exportDataBtn').addEventListener('click', exportData);
            
            // Close Add Guest Modal
            document.getElementById('closeAddGuestModal').addEventListener('click', function() {
                document.getElementById('addGuestModal').style.display = 'none';
            });
            
            // Close Edit Guest Modal
            document.getElementById('closeEditGuestModal').addEventListener('click', function() {
                document.getElementById('editGuestModal').style.display = 'none';
            });
            
            // Close Add Category Modal
            document.getElementById('closeAddCategoryModal').addEventListener('click', function() {
                document.getElementById('addCategoryModal').style.display = 'none';
            });
            
            // Close Reorder Categories Modal
            document.getElementById('closeReorderModal').addEventListener('click', function() {
                document.getElementById('reorderCategoriesModal').style.display = 'none';
            });
            
            // Save New Guest Button
            document.getElementById('saveNewGuest').addEventListener('click', saveNewGuest);
            
            // Cancel Add Guest Button
            document.getElementById('cancelAddGuest').addEventListener('click', function() {
                document.getElementById('addGuestModal').style.display = 'none';
            });
            
            // Update Guest Button
            document.getElementById('updateGuest').addEventListener('click', updateGuest);
            
            // Cancel Edit Guest Button
            document.getElementById('cancelEditGuest').addEventListener('click', function() {
                document.getElementById('editGuestModal').style.display = 'none';
            });
            
            // Save New Category Button
            document.getElementById('saveNewCategory').addEventListener('click', saveNewCategory);
            
            // Cancel Add Category Button
            document.getElementById('cancelAddCategory').addEventListener('click', function() {
                document.getElementById('addCategoryModal').style.display = 'none';
            });
            
            // Save New Category Order Button
            document.getElementById('saveNewOrder').addEventListener('click', saveNewCategoryOrder);
            
            // Cancel Reorder Button
            document.getElementById('cancelReorder').addEventListener('click', function() {
                document.getElementById('reorderCategoriesModal').style.display = 'none';
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            });
            
            // Close gift popups when clicking outside
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.icon-button') && !event.target.closest('.gift-popup')) {
                    document.querySelectorAll('.gift-popup').forEach(popup => {
                        popup.style.display = 'none';
                    });
                }
            });
            
            // Initial render
            renderGuests();
        });

        // Render invitați imediat
        renderGuests();
    </script>
</body>
</html>
